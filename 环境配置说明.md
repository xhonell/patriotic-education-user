# 环境配置说明

## 📁 配置文件

项目已配置了开发环境和生产环境的不同后端路由：

- `.env.development` - 开发环境配置
- `.env.production` - 生产环境配置

## 🌐 环境变量说明

### 开发环境 (.env.development)

```env
# 开发环境配置
VITE_APP_TITLE=青少年爱国教育平台
VITE_APP_ENV=development

# 开发环境 API 地址
VITE_API_BASE_URL=/api

# 开发环境代理目标地址
VITE_API_TARGET_URL=http://localhost:8801
```

**说明：**
- 开发环境使用本地代理 `/api`
- Vite 开发服务器会将 `/api` 请求代理到 `http://localhost:8801`
- 实际请求地址：`/api/server/login/login` → `http://localhost:8801/server/login/login`

### 生产环境 (.env.production)

```env
# 生产环境配置
VITE_APP_TITLE=青少年爱国教育平台
VITE_APP_ENV=production

# 生产环境 API 地址
VITE_API_BASE_URL=https://gateway.xhongwong.cn
```

**说明：**
- 生产环境直接使用完整的后端地址
- 实际请求地址：`https://gateway.xhongwong.cn/server/login/login`

## 📦 NPM 脚本命令

### 开发环境

```bash
# 启动开发服务器（使用开发环境配置）
npm run dev
```

- 端口：http://localhost:3000
- API代理：请求会被代理到 http://localhost:8801
- 热更新：代码修改后自动刷新

### 生产环境构建

```bash
# 构建生产环境版本
npm run build
```

- 输出目录：`dist/`
- API地址：https://gateway.xhongwong.cn
- 代码压缩、优化

### 其他命令

```bash
# 使用开发环境配置构建（用于测试）
npm run build:dev

# 预览生产构建
npm run preview

# 构建并预览
npm run preview:build
```

## 🔧 技术实现

### 1. Vite 配置 (vite.config.js)

```javascript
export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd())
  
  return {
    server: {
      proxy: {
        '/api': {
          target: env.VITE_API_TARGET_URL,  // 从环境变量读取
          changeOrigin: true,
          rewrite: (path) => path.replace(/^\/api/, '')
        }
      }
    }
  }
})
```

### 2. Axios 配置 (src/api/request.js)

```javascript
const baseURL = import.meta.env.VITE_API_BASE_URL

const request = axios.create({
  baseURL: baseURL,  // 根据环境自动切换
  timeout: 10000
})
```

## 🚀 部署流程

### 开发环境

1. 确保后端服务运行在 `http://localhost:8801`
2. 运行 `npm run dev`
3. 访问 http://localhost:3000

### 生产环境

1. 构建项目：
   ```bash
   npm run build
   ```

2. 构建完成后，`dist/` 目录包含所有静态文件

3. 部署 `dist/` 目录到服务器（如 Nginx）

4. 配置 Nginx（参考）：
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       
       root /path/to/dist;
       index index.html;
       
       location / {
           try_files $uri $uri/ /index.html;
       }
   }
   ```

## 📊 API 请求流程

### 开发环境
```
浏览器
  ↓ 请求: /api/server/login/login
Vite Dev Server (localhost:3000)
  ↓ 代理转发: /server/login/login
后端服务器 (localhost:8801)
  ↓ 响应
浏览器
```

### 生产环境
```
浏览器
  ↓ 请求: https://gateway.xhongwong.cn/server/login/login
后端服务器 (gateway.xhongwong.cn)
  ↓ 响应
浏览器
```

## 🔍 调试信息

项目在启动时会在控制台输出当前环境和API地址：

```javascript
🌐 当前环境: development / production
🔗 API 基础地址: /api 或 https://gateway.xhongwong.cn
```

## ⚠️ 注意事项

1. **CORS问题**：
   - 开发环境：通过Vite代理解决
   - 生产环境：需要后端配置CORS允许前端域名

2. **环境变量命名**：
   - Vite环境变量必须以 `VITE_` 开头才能在前端代码中使用
   - 使用 `import.meta.env.VITE_XXX` 访问

3. **构建输出**：
   - 生产构建会将环境变量值编译到代码中
   - 构建后无法通过修改 `.env` 文件改变配置

4. **安全性**：
   - 不要在 `.env` 文件中存储敏感信息（如密钥）
   - `.env*.local` 文件会被 git 忽略，适合存储本地配置

## 📝 修改后端地址

如需修改后端地址，编辑对应的环境配置文件：

**开发环境：**
```bash
# 编辑 .env.development
VITE_API_TARGET_URL=http://new-backend-url:port
```

**生产环境：**
```bash
# 编辑 .env.production  
VITE_API_BASE_URL=https://new-production-url.com
```

修改后需要重启开发服务器或重新构建。

## 🎯 API 接口地址汇总

所有接口都基于 `baseURL` + 接口路径：

| 功能 | 接口路径 | 完整地址示例（生产） |
|------|---------|---------------------|
| 登录 | /server/login/login | https://gateway.xhongwong.cn/server/login/login |
| 注册 | /server/login/register | https://gateway.xhongwong.cn/server/login/register |
| 发送验证码 | /server/login/sendRegisterCode | https://gateway.xhongwong.cn/server/login/sendRegisterCode |
| 获取用户信息 | /server/user/info | https://gateway.xhongwong.cn/server/user/info |
| 上传文件 | /server/common/upload | https://gateway.xhongwong.cn/server/common/upload |

---

✅ 配置完成！现在项目可以根据不同环境自动使用对应的后端地址。

