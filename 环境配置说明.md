# ç¯å¢ƒé…ç½®è¯´æ˜

## ğŸ“ é…ç½®æ–‡ä»¶

é¡¹ç›®å·²é…ç½®äº†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒåç«¯è·¯ç”±ï¼š

- `.env.development` - å¼€å‘ç¯å¢ƒé…ç½®
- `.env.production` - ç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸŒ ç¯å¢ƒå˜é‡è¯´æ˜

### å¼€å‘ç¯å¢ƒ (.env.development)

```env
# å¼€å‘ç¯å¢ƒé…ç½®
VITE_APP_TITLE=é’å°‘å¹´çˆ±å›½æ•™è‚²å¹³å°
VITE_APP_ENV=development

# å¼€å‘ç¯å¢ƒ API åœ°å€
VITE_API_BASE_URL=/api

# å¼€å‘ç¯å¢ƒä»£ç†ç›®æ ‡åœ°å€
VITE_API_TARGET_URL=http://localhost:8801
```

**è¯´æ˜ï¼š**
- å¼€å‘ç¯å¢ƒä½¿ç”¨æœ¬åœ°ä»£ç† `/api`
- Vite å¼€å‘æœåŠ¡å™¨ä¼šå°† `/api` è¯·æ±‚ä»£ç†åˆ° `http://localhost:8801`
- å®é™…è¯·æ±‚åœ°å€ï¼š`/api/server/login/login` â†’ `http://localhost:8801/server/login/login`

### ç”Ÿäº§ç¯å¢ƒ (.env.production)

```env
# ç”Ÿäº§ç¯å¢ƒé…ç½®
VITE_APP_TITLE=é’å°‘å¹´çˆ±å›½æ•™è‚²å¹³å°
VITE_APP_ENV=production

# ç”Ÿäº§ç¯å¢ƒ API åœ°å€
VITE_API_BASE_URL=https://gateway.xhongwong.cn
```

**è¯´æ˜ï¼š**
- ç”Ÿäº§ç¯å¢ƒç›´æ¥ä½¿ç”¨å®Œæ•´çš„åç«¯åœ°å€
- å®é™…è¯·æ±‚åœ°å€ï¼š`https://gateway.xhongwong.cn/server/login/login`

## ğŸ“¦ NPM è„šæœ¬å‘½ä»¤

### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®ï¼‰
npm run dev
```

- ç«¯å£ï¼šhttp://localhost:3000
- APIä»£ç†ï¼šè¯·æ±‚ä¼šè¢«ä»£ç†åˆ° http://localhost:8801
- çƒ­æ›´æ–°ï¼šä»£ç ä¿®æ”¹åè‡ªåŠ¨åˆ·æ–°

### ç”Ÿäº§ç¯å¢ƒæ„å»º

```bash
# æ„å»ºç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬
npm run build
```

- è¾“å‡ºç›®å½•ï¼š`dist/`
- APIåœ°å€ï¼šhttps://gateway.xhongwong.cn
- ä»£ç å‹ç¼©ã€ä¼˜åŒ–

### å…¶ä»–å‘½ä»¤

```bash
# ä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®æ„å»ºï¼ˆç”¨äºæµ‹è¯•ï¼‰
npm run build:dev

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview

# æ„å»ºå¹¶é¢„è§ˆ
npm run preview:build
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. Vite é…ç½® (vite.config.js)

```javascript
export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd())
  
  return {
    server: {
      proxy: {
        '/api': {
          target: env.VITE_API_TARGET_URL,  // ä»ç¯å¢ƒå˜é‡è¯»å–
          changeOrigin: true,
          rewrite: (path) => path.replace(/^\/api/, '')
        }
      }
    }
  }
})
```

### 2. Axios é…ç½® (src/api/request.js)

```javascript
const baseURL = import.meta.env.VITE_API_BASE_URL

const request = axios.create({
  baseURL: baseURL,  // æ ¹æ®ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
  timeout: 10000
})
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒ

1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8801`
2. è¿è¡Œ `npm run dev`
3. è®¿é—® http://localhost:3000

### ç”Ÿäº§ç¯å¢ƒ

1. æ„å»ºé¡¹ç›®ï¼š
   ```bash
   npm run build
   ```

2. æ„å»ºå®Œæˆåï¼Œ`dist/` ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶

3. éƒ¨ç½² `dist/` ç›®å½•åˆ°æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰

4. é…ç½® Nginxï¼ˆå‚è€ƒï¼‰ï¼š
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       
       root /path/to/dist;
       index index.html;
       
       location / {
           try_files $uri $uri/ /index.html;
       }
   }
   ```

## ğŸ“Š API è¯·æ±‚æµç¨‹

### å¼€å‘ç¯å¢ƒ
```
æµè§ˆå™¨
  â†“ è¯·æ±‚: /api/server/login/login
Vite Dev Server (localhost:3000)
  â†“ ä»£ç†è½¬å‘: /server/login/login
åç«¯æœåŠ¡å™¨ (localhost:8801)
  â†“ å“åº”
æµè§ˆå™¨
```

### ç”Ÿäº§ç¯å¢ƒ
```
æµè§ˆå™¨
  â†“ è¯·æ±‚: https://gateway.xhongwong.cn/server/login/login
åç«¯æœåŠ¡å™¨ (gateway.xhongwong.cn)
  â†“ å“åº”
æµè§ˆå™¨
```

## ğŸ” è°ƒè¯•ä¿¡æ¯

é¡¹ç›®åœ¨å¯åŠ¨æ—¶ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºå½“å‰ç¯å¢ƒå’ŒAPIåœ°å€ï¼š

```javascript
ğŸŒ å½“å‰ç¯å¢ƒ: development / production
ğŸ”— API åŸºç¡€åœ°å€: /api æˆ– https://gateway.xhongwong.cn
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **CORSé—®é¢˜**ï¼š
   - å¼€å‘ç¯å¢ƒï¼šé€šè¿‡Viteä»£ç†è§£å†³
   - ç”Ÿäº§ç¯å¢ƒï¼šéœ€è¦åç«¯é…ç½®CORSå…è®¸å‰ç«¯åŸŸå

2. **ç¯å¢ƒå˜é‡å‘½å**ï¼š
   - Viteç¯å¢ƒå˜é‡å¿…é¡»ä»¥ `VITE_` å¼€å¤´æ‰èƒ½åœ¨å‰ç«¯ä»£ç ä¸­ä½¿ç”¨
   - ä½¿ç”¨ `import.meta.env.VITE_XXX` è®¿é—®

3. **æ„å»ºè¾“å‡º**ï¼š
   - ç”Ÿäº§æ„å»ºä¼šå°†ç¯å¢ƒå˜é‡å€¼ç¼–è¯‘åˆ°ä»£ç ä¸­
   - æ„å»ºåæ— æ³•é€šè¿‡ä¿®æ”¹ `.env` æ–‡ä»¶æ”¹å˜é…ç½®

4. **å®‰å…¨æ€§**ï¼š
   - ä¸è¦åœ¨ `.env` æ–‡ä»¶ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†é’¥ï¼‰
   - `.env*.local` æ–‡ä»¶ä¼šè¢« git å¿½ç•¥ï¼Œé€‚åˆå­˜å‚¨æœ¬åœ°é…ç½®

## ğŸ“ ä¿®æ”¹åç«¯åœ°å€

å¦‚éœ€ä¿®æ”¹åç«¯åœ°å€ï¼Œç¼–è¾‘å¯¹åº”çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š

**å¼€å‘ç¯å¢ƒï¼š**
```bash
# ç¼–è¾‘ .env.development
VITE_API_TARGET_URL=http://new-backend-url:port
```

**ç”Ÿäº§ç¯å¢ƒï¼š**
```bash
# ç¼–è¾‘ .env.production  
VITE_API_BASE_URL=https://new-production-url.com
```

ä¿®æ”¹åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨æˆ–é‡æ–°æ„å»ºã€‚

## ğŸ¯ API æ¥å£åœ°å€æ±‡æ€»

æ‰€æœ‰æ¥å£éƒ½åŸºäº `baseURL` + æ¥å£è·¯å¾„ï¼š

| åŠŸèƒ½ | æ¥å£è·¯å¾„ | å®Œæ•´åœ°å€ç¤ºä¾‹ï¼ˆç”Ÿäº§ï¼‰ |
|------|---------|---------------------|
| ç™»å½• | /server/login/login | https://gateway.xhongwong.cn/server/login/login |
| æ³¨å†Œ | /server/login/register | https://gateway.xhongwong.cn/server/login/register |
| å‘é€éªŒè¯ç  | /server/login/sendRegisterCode | https://gateway.xhongwong.cn/server/login/sendRegisterCode |
| è·å–ç”¨æˆ·ä¿¡æ¯ | /server/user/info | https://gateway.xhongwong.cn/server/user/info |
| ä¸Šä¼ æ–‡ä»¶ | /server/common/upload | https://gateway.xhongwong.cn/server/common/upload |

---

âœ… é…ç½®å®Œæˆï¼ç°åœ¨é¡¹ç›®å¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒè‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„åç«¯åœ°å€ã€‚

